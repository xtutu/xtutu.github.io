function HHLog(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var i="",n=0;n<arguments.length;n++)0!=n&&(i+=" "),i+=arguments[n];console.log(i)}var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=this.stage;new eui.Theme("resource/default.thm.json",this.stage);UIManager.getInstance().setRoot(t),this.loadRes()},n.onFinishLoading=function(){HHLog("onFinishLoading");var e=HHUtil.getParamFromUrl("type");switch(e){case"test":UIManager.getInstance().pushView(ViewStartup),UIManager.getInstance().pushView(ViewTest);break;case"draw":UIManager.getInstance().pushView(ViewStartup),UIManager.getInstance().pushView(ViewDraw);break;case"lottery":UIManager.getInstance().pushView(ViewStartup),UIManager.getInstance().pushView(ViewLottery);break;default:UIManager.getInstance().pushView(ViewStartup)}},n.loadRes=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.onFinishLoading())},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.setProgress(e.itemsLoaded,e.itemsTotal)},n.setProgress=function(e,t){HHLog("Loading..."+e+"/"+t)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var GAME_WIDTH=960,GAME_HEIGHT=640,LINE_WIDTH=2,PARSE_STR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(arguments.length<0)return"";for(var i=arguments[0],n=1;n<arguments.length;n++){var s=arguments[n];i=i.replace(new RegExp("##"+(n-1)+"##","gm"),s)}return i},HHUtil=function(){function e(){}var t=(__define,e);t.prototype;return e.PrintObj=function(e,t){if(t){var i="\n-------\n";i+=JSON.stringify(e,null,4),i+="\n-------\n",HHLog(i)}else{var i="\n-------\n";for(var n in e)"function"!=typeof e[n]&&(i+=PARSE_STR("[##0##:##1##]\n",n,e[n]));i+="-------\n",HHLog(i)}},e.RandByRange=function(e,t){if(e==t-1)return e;if(e==t)return t;if(e>t){var i=t;t=e,e=i}var n=Math.floor(Math.random()*(t-e));return e+n},e.RandEither=function(e,t){return 0==e?!1:e>=t?!0:Math.floor(Math.random()*t)<e?!0:!1},e.RandByRangeMulti=function(t,i,n){var s=[];if(t==i)return s;if(t>i){var r=i;i=t,t=r}if(n>=i-t){for(var o=t;i>o;o++)s.push(o);return s}for(var a=i-t,h=[],o=0;a>o;o++)h[o]=o;for(var o=0;n>o;o++){var d=e.RandByRange(0,a);s.push(t+h[d]),h[d]=h[a-1],a--}return s},e.padNumber=function(e,t){var i="000000000"+e;return i.substr(i.length-t)},e.FlyTextInSceneCenter=function(e){var t=UIManager.getInstance().getStage();if(t){var i=new eui.Label;t.addChild(i),i.textColor=16711680,i.strokeColor=16777215,i.stroke=3,i.size=28,i.x=GAME_WIDTH/2,i.y=GAME_HEIGHT/2,i.text=e,i.anchorOffsetX=i.width/2,HHLog("x ",i.anchorOffsetX),i.anchorOffsetY=i.height/2,egret.Tween.get(i,{loop:!1}).to({y:i.y-200},1e3).wait(500).call(function(){t.removeChild(i)})}},e.getParamFromUrl=function(e){var t=window.location.href,i=t.split("?"),n="";if(i[0]==t)return n;var s=i[1];i=s.split("&");for(var r=0;r<i.length;r++){s=i[r];var o=s.split("=");o.length<=1||o[0]==e&&(n=o[1])}return n},e.getClassName=function(e){if(e.prototype){if(e.prototype.__class__&&e.prototype.constructor)return e.prototype.__class__}else{if(!e.__proto__)return void console.warn(e,"is not a class!");if(e.__proto__.__class__&&e.__proto__.constructor)return e.__proto__.__class__}},e}();egret.registerClass(HHUtil,"HHUtil");var HttpClient=function(){function e(){if(e._instance)throw new Error("Error: Instantiation failed: Use HttpClient.getInstance() instead of new.");HHLog("HttpClient create"),this.init(),e._instance=this}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null===e._instance&&(e._instance=new e),e._instance},i.init=function(){},i.doGet=function(e,t,i){var n=new egret.HttpRequest,s=function(e){i(n.response)};e+="?";var r=0;for(var o in t)r>0&&(e+="&"),e=e+encodeURIComponent(o)+"="+encodeURIComponent(t[o]),r++;n.addEventListener(egret.Event.COMPLETE,s,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,s,this),n.open(e,egret.HttpMethod.GET),n.send()},i.doPost=function(e,t,i){var n=new egret.HttpRequest,s=function(e){i(n.response)},r="",o=0;for(var a in t)o>0&&(r+="&"),r=r+encodeURIComponent(a)+"="+encodeURIComponent(t[a]),o++;n.addEventListener(egret.Event.COMPLETE,s,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,s,this),n.open(e,egret.HttpMethod.POST),n.setRequestHeader("content-type","application/x-www-form-urlencoded"),n.send(r)},e._instance=null,e}();egret.registerClass(HttpClient,"HttpClient");var UIManager=function(){function e(){if(this.views=[],this.currentView=null,e._instance)throw new Error("Error: Instantiation failed: Use UIManager.getInstance() instead of new.");HHLog("UIManager create"),this.init(),e._instance=this}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null===e._instance&&(e._instance=new e),e._instance},i.init=function(){},i.setRoot=function(e){this._root=e},i.pushView=function(e){HHLog("pushView = "+e.name),this.currentView&&(this._root.removeChild(this.currentView),HHLog("remove view",this.currentView));for(var t=-1,i=0;i<this.views.length;i++)if(this.views[i]==e){t=i,HHLog("already exists");break}if(-1!=t)for(var i=this.views.length-1;i>=0&&this.views[i]!=e;i--)this.popView();else this.views.push(e),this.currentView=new e,this._root.addChildAt(this.currentView,1)},i.popView=function(){if(HHLog("popView... length = "+this.views.length),this.views.length<=0)return void HHLog("error popView lenght = "+this.views.length);this.currentView&&(this._root.removeChild(this.currentView),HHLog("remove view",this.currentView)),this.views.pop();var e=this.views[this.views.length-1];this.currentView=new e,this._root.addChildAt(this.currentView,1)},i.getStage=function(){return e.getInstance()._root},e._instance=null,e}();egret.registerClass(UIManager,"UIManager");var DrawNode=function(e){function t(){e.call(this),this.m_shp=null,this.m_bitmap=null,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this.initViewBg(),this.m_bitmap=new egret.Bitmap,this.m_bitmap.width=this.width,this.m_bitmap.height=this.height,this.m_bitmap.anchorOffsetX=0,this.m_bitmap.anchorOffsetY=0,this.addChild(this.m_bitmap),this.m_shp=new egret.Shape,this.m_shp.width=this.width,this.m_shp.height=this.height,this.addChild(this.m_shp)},n.initViewBg=function(){this.graphics.lineStyle(LINE_WIDTH,0),this.graphics.beginFill(8355711,1),this.graphics.drawRect(0,0,this.width,this.height),this.graphics.endFill()},n.onTouch=function(e,t,i){var n=new egret.Point(t,i);switch(e){case egret.TouchEvent.TOUCH_BEGIN:DrawSystem.getInstance().setLastPoint(null),this.redraw(n),this.refreshToBitmap();break;case egret.TouchEvent.TOUCH_MOVE:this.redraw(n),this.refreshToBitmap();break;case egret.TouchEvent.TOUCH_END:HHLog("end")}DrawSystem.getInstance().setLastPoint(n)},n.redraw=function(e){this.m_shp.graphics.clear(),this.m_shp.graphics.lineStyle(3,0,1,!0,"","","round");var t=DrawSystem.getInstance().getLastPoint();null==t&&(t=e),this.m_shp.graphics.moveTo(t.x,t.y),this.m_shp.graphics.lineTo(e.x,e.y),this.m_shp.graphics.endFill()},n.refreshToBitmap=function(){var e=new egret.RenderTexture;e.textureWidth=this.width,e.textureHeight=this.height,e.drawToTexture(this,new egret.Rectangle(0,0,this.width,this.height)),this.m_bitmap.texture=e,HHLog(this.m_bitmap.anchorOffsetX,this.anchorOffsetX)},t}(egret.Sprite);egret.registerClass(DrawNode,"DrawNode");var DrawSystem=function(){function e(){if(this.lastPoint=null,e._instance)throw new Error("Error: Instantiation failed: Use DrawSystem.getInstance() instead of new.");this.init(),e._instance=this}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null===e._instance&&(e._instance=new e),e._instance},i.init=function(){this.clearPoints()},i.clearPoints=function(){this.lastPoint=null},i.setLastPoint=function(e){this.lastPoint=e},i.getLastPoint=function(){return this.lastPoint},e._instance=null,e}();egret.registerClass(DrawSystem,"DrawSystem");var ViewBase=function(e){function t(){e.call(this),this.buttons=[],this.tweens=[],this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onEnter,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onExit,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onEnter=function(e){},n.onExit=function(e){this.removeAllTween()},n.removeAllTween=function(){HHLog("removeAllTween length",this.tweens.length);for(var e=0;e<this.tweens.length;e++)egret.Tween.removeTweens(this.tweens[e]);this.tweens=[]},n.addTestButton=function(e,t,i){var n=new eui.Button;return n.label=e,n.x=0,n.y=GAME_HEIGHT-60*this.buttons.length-60,n.addEventListener(egret.TouchEvent.TOUCH_TAP,t,i),this.buttons.push(n),this.addChild(n),n},n.addTweenObj=function(e){this.tweens.push(e)},t}(egret.DisplayObjectContainer);egret.registerClass(ViewBase,"ViewBase");var ViewDraw=function(e){function t(){e.call(this),this.drawNode=null,this.createView(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.width=GAME_WIDTH,this.height=GAME_HEIGHT}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.drawNode=new DrawNode,this.drawNode.width=GAME_WIDTH,this.drawNode.height=GAME_HEIGHT,this.drawNode.anchorOffsetX=0,this.drawNode.anchorOffsetY=0,this.drawNode.x=0,this.drawNode.y=0,this.addChildAt(this.drawNode,0),this.addTestButton("返回",function(){UIManager.getInstance().popView()},null)},n.onTouch=function(e){this.drawNode&&this.drawNode.onTouch(e.type,e.stageX,e.stageY)},t}(ViewBase);egret.registerClass(ViewDraw,"ViewDraw");var LotteryCtrl=function(){function e(e){this.maxSpeed=1080,this.startLotteryAngle=0,this.usedTime=0,this.uniformSpeedTime=0,this.speedUpTime=1,this.speedCutTime=2,this.isDataSet=!1,this.timer=null,this.dtMs=20,this.lotteryNode=null,this.lotteryNode=e,this.timer=new egret.Timer(this.dtMs,0)}var t=(__define,e),i=t.prototype;return i.start=function(){this.reset(),this.startLotteryAngle=this.getAngle(),this.timer.addEventListener(egret.TimerEvent.TIMER,this._update,this),this.timer.start()},i.reset=function(){this.usedTime=0,this.isDataSet=!1,this.timer.removeEventListener(egret.TimerEvent.TIMER,this._update,this),this.timer.stop()},i.exit=function(){this.reset()},i.setData=function(e){this.startLotteryAngle=this.getAngle();var t=0,i=0;this.usedTime<this.speedUpTime?(t=(this.getCurrentSpeed()+this.maxSpeed)*(this.speedUpTime-this.usedTime)/2,i=this.maxSpeed/this.speedUpTime*this.usedTime*this.usedTime/2):(i=this.maxSpeed/this.speedUpTime*this.speedUpTime*this.speedUpTime/2,this.usedTime=this.speedUpTime),this.startLotteryAngle-=i;var n=this.maxSpeed*this.speedCutTime/2,s=e-this.startLotteryAngle-i-t-n;s+=1800,this.uniformSpeedTime=s/this.maxSpeed,this.isDataSet=!0},i.getCurrentSpeed=function(){return this.usedTime<this.speedUpTime?this.usedTime*(this.maxSpeed/this.speedUpTime):this.isDataSet?this.maxSpeed:this.usedTime<this.speedUpTime+this.uniformSpeedTime||!this.isDataSet?this.maxSpeed:this.maxSpeed-this.usedTime*(this.maxSpeed/this.speedUpTime)},i._update=function(e){e=this.dtMs/1e3,this.usedTime+=e;var t=0,i=this.usedTime;i>this.speedUpTime&&(i=this.speedUpTime);var n=this.maxSpeed/this.speedUpTime*i*i/2;if(t+=n,this.usedTime>this.speedUpTime){var i=this.usedTime-this.speedUpTime;i>=this.uniformSpeedTime&&this.isDataSet&&(i=this.uniformSpeedTime);var n=this.maxSpeed*i;t+=n}var s=!1;if(this.isDataSet&&this.usedTime>this.speedUpTime+this.uniformSpeedTime){var i=this.usedTime-(this.speedUpTime+this.uniformSpeedTime);i>this.speedCutTime&&(i=this.speedCutTime,s=!0);var n=this.maxSpeed*i-this.maxSpeed/this.speedCutTime*i*i/2;t+=n}this.setAngle(t+this.startLotteryAngle),s&&this.reset()},i.setAngle=function(e){this.lotteryNode.rotation=Math.floor(e)%360},i.getAngle=function(){return this.lotteryNode.rotation},e}();egret.registerClass(LotteryCtrl,"LotteryCtrl");var ViewLottery=function(e){function t(){e.call(this),this.sprite=null,this.lottery=null,this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){var e=this;this.addTestButton("返回",function(){UIManager.getInstance().popView()},null),this.addTestButton("转",function(){e.lottery.start()},null),this.addTestButton("停",function(){var t=HHUtil.RandByRange(0,360);e.lottery.setData(t),HHUtil.FlyTextInSceneCenter("角度 = "+t)},null);var t=new egret.Sprite;t.width=GAME_WIDTH,t.height=GAME_HEIGHT,t.graphics.beginFill(10526880,1),t.graphics.drawCircle(GAME_WIDTH/2,GAME_HEIGHT/2,150),t.graphics.endFill(),this.addChildAt(t,0);var i=new egret.Bitmap;i.x=GAME_WIDTH/2,i.y=GAME_HEIGHT/2,i.texture=RES.getRes("pointer"),i.anchorOffsetX=.5*i.width,i.anchorOffsetY=i.height,this.addChildAt(i,1),this.lottery=new LotteryCtrl(i)},n.onExit=function(t){HHLog("onExit"),this.lottery&&this.lottery.exit(),e.prototype.onExit.call(this,t)},t}(ViewBase);egret.registerClass(ViewLottery,"ViewLottery");var ViewRequest=function(e){function t(){e.call(this),this.sprite=null,this.label=new eui.Label,this.createView(),this.label.x=30,this.label.y=GAME_HEIGHT/2,this.addChild(this.label)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){var e=this;this.addTestButton("返回",function(){UIManager.getInstance().popView()}.bind(this),null),this.addTestButton("Get",function(){var t={machineId:"xxxxx"};HttpClient.getInstance().doGet("http://192.168.0.196:3501/2/cardMachine/getServerTime",t,function(t){e.label.text=t,HHLog("body",t)})}.bind(this),null),this.addTestButton("Post",function(){var t={machineId:"xxxxx",version:"1.2"};HttpClient.getInstance().doPost("http://192.168.0.196:3501/2/cardMachine/checkUpdate",t,function(t){e.label.text=t,HHLog("body",t)})}.bind(this),null),this.addTestButton("Mp3",function(){e.startLoad()}.bind(this),null)},n.startLoad=function(){var e=new egret.URLLoader;e.dataFormat=egret.URLLoaderDataFormat.SOUND,e.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this);var t="resource/sound/1.mp3",i=new egret.URLRequest(t);e.load(i)},n.onLoadComplete=function(e){var t=e.target,i=t.data,n=i.play(0,1);n.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)},n.onSoundComplete=function(e){console.log("onSoundComplete")},t}(ViewBase);egret.registerClass(ViewRequest,"ViewRequest");var ViewStartup=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){var e=new egret.Sprite;e.width=GAME_WIDTH,e.height=GAME_HEIGHT,e.graphics.beginFill(10526880,1),e.graphics.drawRect(0,0,GAME_WIDTH,GAME_HEIGHT),e.graphics.endFill(),this.addChildAt(e,0),this.addTestButton("画图测试",function(){UIManager.getInstance().pushView(ViewDraw)},null),this.addTestButton("代码测试",function(){UIManager.getInstance().pushView(ViewTest)},null),this.addTestButton("转盘",function(){UIManager.getInstance().pushView(ViewLottery)},null),this.addTestButton("Request",function(){UIManager.getInstance().pushView(ViewRequest)},null)},t}(ViewBase);egret.registerClass(ViewStartup,"ViewStartup");var ViewTest=function(e){function t(){e.call(this),this.sprite=null,this.nameTest="testNode",this.moveNode=null,this.alphaNode=null,this.rotationNode=null,this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.sprite=new egret.Sprite,this.sprite.width=300,this.sprite.height=300,this.sprite.touchEnabled=!0,this.sprite.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.sprite.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.sprite.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.addChild(this.sprite),this.addTestButton("返回",function(){UIManager.getInstance().popView()},null);var e=this;this.addTestButton("Tween",function(){e.clearTest(),e.testTween()}.bind(this),null),this.addTestButton("飘文字",function(){e.clearTest(),e.testFlyText()}.bind(this),null),this.addTestButton("JS模块",function(){e.clearTest(),e.testJsModule()}.bind(this),null)},n.onTouch=function(e){switch(HHLog(PARSE_STR("test :(##0##, ##1##)  (##2##,##3##)",e.localX,e.localY,e.stageX,e.stageY)),e.type){case egret.TouchEvent.TOUCH_BEGIN:break;case egret.TouchEvent.TOUCH_MOVE:break;case egret.TouchEvent.TOUCH_END:}},n.clearTest=function(){var e=this.getChildByName(this.nameTest);e&&(this.removeChild(e),this.removeAllTween())},n.testTween=function(){var e=new egret.DisplayObjectContainer;e.name=this.nameTest,e.y=200,this.addChild(e);var t=RES.getRes("panel_back_png");this.moveNode=new egret.Bitmap,this.moveNode.texture=t,this.moveNode.x=50,this.moveNode.y=50,e.addChild(this.moveNode),this.addTweenObj(egret.Tween.get(this.moveNode,{loop:!0}).to({x:250},2e3).to({x:50},2e3).call(function(){console.log("Hello,Tween!")})),this.addTweenObj(this.moveNode),this.alphaNode=new egret.Bitmap,this.alphaNode.texture=t,this.alphaNode.x=250,this.alphaNode.y=50,e.addChild(this.alphaNode),egret.Tween.get(this.alphaNode,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3),this.addTweenObj(this.alphaNode),this.rotationNode=new egret.Bitmap,this.rotationNode.texture=t,this.rotationNode.x=150,this.rotationNode.y=150,e.addChild(this.rotationNode),egret.Tween.get(this.rotationNode,{loop:!0}).to({rotation:360},2e3).wait(500),this.addTweenObj(this.rotationNode)},n.testFlyText=function(){HHUtil.FlyTextInSceneCenter("我是文字"+HHUtil.RandByRange(1,1e5))},n.testJsModule=function(){for(var e=0;e<globalTest.length;e++)HHLog("global ",e,globalTest[e]);share("123"),JsTest.test("123","456","abc","def")},t}(ViewBase);egret.registerClass(ViewTest,"ViewTest");